<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="utf-8"/>
        <script type="module">
            import Module from './build/Debug/12_monitor_dependencies.js';
            const fs_data_path = '/data.txt';

            let v = 0;

            const moduleArgs = {
                arguments: [fs_data_path],
                monitorRunDependencies: left => console.log(`left ${left}`),
                preRun: [
                    emsModule => {
                        emsModule.addRunDependency('data');

                        fetch('./data.txt')
                            .then(response => response.arrayBuffer())
                            .then(buffer => {
                                console.log('write file');
                                emsModule.FS.writeFile(fs_data_path, new Uint8Array(buffer));

                                emsModule.removeRunDependency('data');
                            });
                    },
                ],
            };

            Module(moduleArgs).then(emsModule =>
            {
                v = emsModule._increment(v);
                console.log(`return=${v}`);
            });
        </script>
    </head>
    <body>
    </body>
</html>